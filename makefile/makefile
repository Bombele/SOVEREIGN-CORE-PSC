# Makefile - Syst√®me SRC Combat-Ready

# Compilation et durcissement
build:
	@echo "[BUILD] Compilation du binaire..."
	@kotlinc -d bin/ src/**/*.kt

harden:
	@echo "[HARDEN] Application des routines d'obscurcissement..."
	@./scripts/harden_binary.sh

# S√©curit√©
rotate-keys:
	@echo "[SECURITY] Rotation des cl√©s de mission..."
	@./scripts/rotate_keys.sh

check-integrity:
	@echo "[SECURITY] V√©rification d'int√©grit√©..."
	@./scripts/integrity_check.sh

clean-logs:
	@echo "[SECURITY] Nettoyage des logs..."
	@./scripts/clean_logs.sh

deploy:
	@echo "[DEPLOY] D√©ploiement terrain..."
	@./infra/deployment/deploy.sh

# Tests unitaires
test:
	@echo "[TEST] Simulation compl√®te..."
	@./scripts/run_tests.sh

# üöÄ Test Final de Recette
recette:
	@echo "=== [TEST FINAL DE RECETTE - SRC] ==="
	@if [ ! -f "data/keys/master.key" ]; then \
		echo "[FAIL] Cl√©s de mission absentes."; exit 1; \
	else \
		echo "[OK] Cl√©s de mission pr√©sentes."; \
	fi
	@echo "[INFO] Test Geofence..."
	@./scripts/simulate_gps_outside_zone.sh || { echo "[FAIL] Geofence non d√©clench√©."; exit 1; }
	@echo "[OK] Geofence d√©clench√© correctement."
	@echo "[INFO] Chargement mod√®le IA..."
	@./scripts/test_sigint.sh || echo "[WARN] Mod√®le IA absent, mode d√©grad√©."
	@echo "[INFO] Test MeshSyncEngine..."
	@./scripts/test_mesh.sh || { echo "[FAIL] MeshSyncEngine non op√©rationnel."; exit 1; }
	@echo "[OK] MeshSyncEngine op√©rationnel."
	@echo "[INFO] Test diffusion BFT..."
	@./scripts/test_bft.sh || { echo "[FAIL] BFT non diffus√©."; exit 1; }
	@echo "[OK] BFT diffus√©."
	@echo "[INFO] Test FusionOverlay..."
	@./scripts/test_ui.sh || { echo "[FAIL] UI non fonctionnelle."; exit 1; }
	@echo "[OK] FusionOverlay op√©rationnel."
	@echo "=== [RECETTE TERMIN√âE : SYST√àME COMBAT-READY] ==="

# üöÄ Recette SIGINT (COMINT)
recette-sigint:
	@echo "=== [RECETTE SIGINT - COMINT] ==="
	@kotlinc -d bin/ src/**/*.kt sigint/**/*.kt tests/**/*.kt
	@java -cp bin sigint.comint.tests.ComintTest
	@echo "=== [RECETTE SIGINT TERMIN√âE] ==="

# Recette globale SIGINT
recette-sigint-full: recette-sigint
	@echo "=== [LANCEMENT RECETTE ELINT] ==="
	@java -cp bin sigint.elint.tests.ElintTest
	@echo "=== [SYST√àME SIGINT TOTALEMENT VALID√â] ==="

# üöÄ Recette SIGINT (ELINT - RADAR)
recette-elint:
	@echo "=== [RECETTE SIGINT - ELINT] ==="
	@kotlinc -d bin/ src/**/*.kt sigint/**/*.kt tests/*.kt
	@java -cp bin sigint.elint.tests.ElintTest
	@echo "=== [RECETTE ELINT TERMIN√âE] ==="

# Recette Globale SIGINT (COMINT + ELINT)
recette-sigint-full: recette-sigint recette-elint
	@echo "üõ°Ô∏è  CHA√éNE SIGINT INT√âGRALE VALID√âE"

# üöÄ Recette SIGINT (FISINT)
recette-fisint:
	@echo "=== [RECETTE SIGINT - FISINT] ==="
	@kotlinc -d bin/ src/**/*.kt sigint/**/*.kt tests/*.kt
	@java -cp bin sigint.fisint.tests.FisintTest
	@echo "=== [RECETTE FISINT TERMIN√âE] ==="

# üî• RECETTE SIGINT FULL (Le Triptyque)
recette-sigint-full: recette-sigint recette-elint recette-fisint
	@echo "=========================================================="
	@echo "üõ°Ô∏è  CHA√éNE ROEM 100% VALID√âE : COMINT + ELINT + FISINT"
	@echo "üöÄ SYST√àME SRC PR√äT POUR D√âPLOIEMENT SOUVERAIN"
	@echo "=========================================================="
